# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Nikita

## üìä –ù–æ–≤–∞—è –≤–µ–±-–ø–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –î–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏
–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ:
```
http://localhost:8984/
```

### –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ

#### 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–æ–∫
- **ClickHouse**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π, –æ—à–∏–±–∫–∏, –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- **Solr**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
- **Redis**: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
- **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã**: uptime —Å–ª—É–∂–±—ã

#### 2. –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- üü¢ **–ó–µ–ª—ë–Ω—ã–π** = —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π** = –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

#### 3. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
–ë–ª–æ–∫ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 5 –æ—à–∏–±–∫–∞–º–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

#### 4. –°–ø–∏—Å–æ–∫ –±–∞–∑
–¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –±–∞–∑ 1–° —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üìà API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü–æ–ª—É—á–∏—Ç—å JSON —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```bash
curl http://localhost:8984/stats_api
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "uptime_formatted": "1—á 30–º 15—Å",
  "clickhouse": {
    "enabled": true,
    "host": "localhost",
    "port": 9000,
    "database": "zhr1c",
    "connection_ok": true,
    "total_sent": 1096,
    "total_errors": 0,
    "last_success_time": "2025-12-05T11:53:11.281697"
  }
}
```

---

## üìù –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≥–∏

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –≤—ã –≤–∏–¥–∏—Ç–µ:
- ‚úì –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úó –û—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º traceback
- üìä –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∑–∞–ø–∏—Å–µ–π/—Å–µ–∫)
- üìà –°—á—ë—Ç—á–∏–∫–∏ –∑–∞ –≤—Å—é —Å–µ—Å—Å–∏—é

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤
```
2025-12-05 11:53:11.242833:::lgp parser:::‚Üí CLICKHOUSE: –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∞–∫–µ—Ç–∞ –¥–ª—è –±–∞–∑—ã 'PLATA_ZUP_PROD' (–∑–∞–ø–∏—Å–µ–π: 200)
2025-12-05 11:53:11.281697:::lgp parser:::‚úì CLICKHOUSE: –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 200 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É zhr1c.PLATA_ZUP_PROD
2025-12-05 11:53:11.281697:::lgp parser:::‚úì CLICKHOUSE: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 0.016 —Å–µ–∫ (12451.5 –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫)
2025-12-05 11:53:11.281697:::lgp parser:::‚úì CLICKHOUSE: –í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é: 1096 –∑–∞–ø–∏—Å–µ–π
```

---

## üîç –ö–∞–∫ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–ø–∞–Ω–µ–ª—å
–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8984/` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ:
- –ï—Å—Ç—å –ª–∏ –∫—Ä–∞—Å–Ω—ã–µ üî¥ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã?
- –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ –±–ª–æ–∫–µ "üö® –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏"?

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
```bash
tail -f /opt/Nikita/debug/Nikita.*.log | grep "‚úó"
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```bash
curl http://localhost:8984/stats_api | grep connection_ok
```

---

## ‚öôÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

### Prometheus
```python
import requests
from prometheus_client import Gauge

# –ú–µ—Ç—Ä–∏–∫–∞
records_sent = Gauge('nikita_records_sent', 'Total records sent')

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
stats = requests.get('http://localhost:8984/stats_api').json()
records_sent.set(stats['clickhouse']['total_sent'])
```

### Zabbix
```bash
# Item key
nikita.clickhouse.sent

# Script
curl -s http://localhost:8984/stats_api | jq '.clickhouse.total_sent'
```

---

## üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–°–º. [MONITORING_IMPROVEMENTS.md](MONITORING_IMPROVEMENTS.md)

---

*–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è: 2025-12-05*
